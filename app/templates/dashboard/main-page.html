{% extends "dashboard/dashboard.html" %}
{% load static %}

{% block dashboard_content %}
  <div class="font-sans leading-tight bg-grey-lighter p-4">
    <div class="flex items-center text-gray-800">
      <div class="pb-4 w-full md:px-8 lg:px-16 xl:px-32">
        <div class="grid grid-cols-12 gap-4">
          <div class="col-span-12 sm:col-span-6 md:col-span-3">
            <a href="{% url 'users:profile' %}" class="flex flex-row bg-white shadow-sm rounded p-4 duration-300 cursor-pointer hover:bg-gray-100 hover:shadow-lg">
              <div class="flex items-center justify-center flex-shrink-0 h-12 w-12 rounded-xl bg-blue-100 text-blue-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
              </div>
              <div class="flex flex-col flex-grow ml-4">
                <div class="text-sm text-gray-500">Mój profil</div>
                <div class="font-bold text-lg">{{ user.first_name }} {{ user.last_name }}</div>
              </div>
            </a>
          </div>
          <div class="col-span-12 sm:col-span-6 md:col-span-3">
            <a href="{% url 'courses:courses' %}" class="flex flex-row bg-white shadow-sm rounded p-4 duration-300 cursor-pointer hover:bg-gray-100 hover:shadow-lg">
              <div class="flex items-center justify-center flex-shrink-0 h-12 w-12 rounded-xl bg-green-100 text-green-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.927,5.828h-4.41l-1.929-1.961c-0.078-0.079-0.186-0.125-0.297-0.125H4.159c-0.229,0-0.417,0.188-0.417,0.417v1.669H2.073c-0.229,0-0.417,0.188-0.417,0.417v9.596c0,0.229,0.188,0.417,0.417,0.417h15.854c0.229,0,0.417-0.188,0.417-0.417V6.245C18.344,6.016,18.156,5.828,17.927,5.828 M4.577,4.577h6.539l1.231,1.251h-7.77V4.577z M17.51,15.424H2.491V6.663H17.51V15.424z"></path></svg>
              </div>
              <div class="flex flex-col flex-grow ml-4">
                <div class="text-sm text-gray-500">Moje Kursy</div>
                <div class="font-bold text-lg">{{courses_count}}</div>
              </div>
            </a>
          </div>
          <div class="col-span-12 sm:col-span-6 md:col-span-3">
            <a href="#" class="flex flex-row bg-white shadow-sm rounded p-4 duration-300 cursor-pointer hover:bg-gray-100 hover:shadow-lg">
              <div class="flex items-center justify-center flex-shrink-0 h-12 w-12 rounded-xl bg-orange-100 text-orange-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M16.85,7.275l-3.967-0.577l-1.773-3.593c-0.208-0.423-0.639-0.69-1.11-0.69s-0.902,0.267-1.11,0.69L7.116,6.699L3.148,7.275c-0.466,0.068-0.854,0.394-1,0.842c-0.145,0.448-0.023,0.941,0.314,1.27l2.871,2.799l-0.677,3.951c-0.08,0.464,0.112,0.934,0.493,1.211c0.217,0.156,0.472,0.236,0.728,0.236c0.197,0,0.396-0.048,0.577-0.143l3.547-1.864l3.548,1.864c0.18,0.095,0.381,0.143,0.576,0.143c0.256,0,0.512-0.08,0.729-0.236c0.381-0.277,0.572-0.747,0.492-1.211l-0.678-3.951l2.871-2.799c0.338-0.329,0.459-0.821,0.314-1.27C17.705,7.669,17.316,7.343,16.85,7.275z M13.336,11.754l0.787,4.591l-4.124-2.167l-4.124,2.167l0.788-4.591L3.326,8.5l4.612-0.67l2.062-4.177l2.062,4.177l4.613,0.67L13.336,11.754z"></svg>
              </div>
              <div class="flex flex-col flex-grow ml-4">
                <div class="text-sm text-gray-500">Moje oceny</div>
                <div class="font-bold text-lg">4.87</div>
              </div>
            </a>
          </div>
          <div class="col-span-12 sm:col-span-6 md:col-span-3">
            <a href="{% url 'users:schedule' %}" class="flex flex-row bg-white shadow-sm rounded p-4 duration-300 cursor-pointer hover:bg-gray-100 hover:shadow-lg">
              <div class="flex items-center justify-center flex-shrink-0 h-12 w-12 rounded-xl bg-red-100 text-red-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M15.396,2.292H4.604c-0.212,0-0.385,0.174-0.385,0.386v14.646c0,0.212,0.173,0.385,0.385,0.385h10.792c0.211,0,0.385-0.173,0.385-0.385V2.677C15.781,2.465,15.607,2.292,15.396,2.292 M15.01,16.938H4.99v-2.698h1.609c0.156,0.449,0.586,0.771,1.089,0.771c0.638,0,1.156-0.519,1.156-1.156s-0.519-1.156-1.156-1.156c-0.503,0-0.933,0.321-1.089,0.771H4.99v-3.083h1.609c0.156,0.449,0.586,0.771,1.089,0.771c0.638,0,1.156-0.518,1.156-1.156c0-0.638-0.519-1.156-1.156-1.156c-0.503,0-0.933,0.322-1.089,0.771H4.99V6.531h1.609C6.755,6.98,7.185,7.302,7.688,7.302c0.638,0,1.156-0.519,1.156-1.156c0-0.638-0.519-1.156-1.156-1.156c-0.503,0-0.933,0.322-1.089,0.771H4.99V3.062h10.02V16.938z M7.302,13.854c0-0.212,0.173-0.386,0.385-0.386s0.385,0.174,0.385,0.386s-0.173,0.385-0.385,0.385S7.302,14.066,7.302,13.854 M7.302,10c0-0.212,0.173-0.385,0.385-0.385S8.073,9.788,8.073,10s-0.173,0.385-0.385,0.385S7.302,10.212,7.302,10 M7.302,6.146c0-0.212,0.173-0.386,0.385-0.386s0.385,0.174,0.385,0.386S7.899,6.531,7.688,6.531S7.302,6.358,7.302,6.146"></path>
                </svg>
              </div>
              <div class="flex flex-col flex-grow ml-4">
                <div class="text-sm text-gray-500">Plan zajęć</div>
                <div class="font-bold text-lg">{{ now|date:"d.m.Y" }}</div>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>
    {% if request.user.is_student %}
      <div class="flex flex-wrap mt-4 mb-4 md:px-8 lg:px-16 xl:px-32">
        <div class="bg-white pb-4 px-4 mb-4 w-full lg:flex-1 lg:mb-0 lg:mr-4 rounded-md shadow-md">
          <h4 class="flex items-center pt-4 text-lg leading-6 font-medium text-gray-900 mb-2">
            Najnowsze oceny
          </h4>
          {% if not marks %}
            Brak wystawionych ocen.
          {% else %}
            <div class="flex pb-12 h-full justify-between flex-col flex-wrap">
              <div class="overflow-x-auto mt-6">
                <table class="table-auto border-collapse w-full mt-1">
                  <thead>
                  <tr class="rounded-t-lg text-sm font-medium text-gray-700 text-left" style="font-size: 0.9674rem">
                    <th class="px-4 py-2">Kurs</th>
                    <th class="px-4 py-2">Ocena</th>
                    <th class="px-4 py-2">Opis</th>
                    <th class="px-4 py-2">Prowadzący</th>
                    <th class="px-4 py-2">Data</th>
                  </tr>
                  </thead>
                  <tbody class="text-sm font-normal text-gray-700">
                  {% for mark in marks %}
                    <tr class="hover:bg-gray-100 border-b border-gray-200 py-10">
                      <td class="px-4 py-4"><a class="text-blue-400 hover:text-blue-500" href="{% url 'courses:courses-detail' mark.course.slug %}">{{ mark.course.name }}</a></td>
                      <td class="px-4 py-4">{{ mark.mark }}% ({{ mark.mark_decimal }})</td>
                      <td class="px-4 py-4">{% if mark.description %}{{ mark.description }}{% else %}-{% endif %}</td>
                      <td class="px-4 py-4"><a class="text-blue-400 hover:text-blue-500" href="{% url 'users:profile-detail' mark.teacher.pk %}">{{ mark.teacher.first_name }} {{ mark.teacher.last_name }}</a></td>
                      <td class="px-4 py-4">{{ mark.date }}</td>
                    </tr>
                  {% endfor %}
                  </tbody>
                </table>
              </div>
              <div class="mb-2">
                <a href="{% url 'users:marks' %}" class="text-sm font-bold mt-2 mb-4 px-4 transition-all duration-200 py-2 px-2 rounded-lg bg-gray-200 text-gray-800 hover:text-gray-900 hover:bg-gray-300">
                  Przejdź do ocen
                </a>
              </div>
            </div>
          {% endif %}
        </div>
        <div class="bg-white pb-4 px-4 w-full max-w-lg lg:flex-1 rounded-md shadow-md">
          <h4 class="flex items-center pt-4 text-lg leading-6 font-medium text-gray-900 mb-2">
            Oceny
          </h4>
          <canvas id="marks" width="400" height="400"></canvas>
        </div>
      </div>
    {% endif %}
    <div class="flex md:px-8 lg:px-16 xl:px-32">
      <div class="bg-white pb-4 px-4 rounded-md w-full shadow-md">
        <h4 class="flex items-center pt-4 text-lg leading-6 font-medium text-gray-900 mb-2">
          Ostatnie ogłoszenia
          {% if not_viewed_notices %}
            <a href="{% url 'users:notices' %}" class="ml-4 rounded-full bg-green-400 hover:bg-green-500 duration-300 text-sm text-white px-2 py-1 rounded  leading-none flex items-center">
              Nowe
              <span class="bg-white p-1 rounded-full text-blue-600 text-xs ml-2 mr-1">
            {{ not_viewed_notices }}
          </span>
            </a>
          {% endif %}
        </h4>
        {% if not notices %}
          Brak ogłoszeń.
        {% else %}
          <div class="overflow-x-auto mt-6">
            <table class="table-auto border-collapse w-full mt-1">
              <thead>
              <tr class="rounded-t-lg text-sm font-medium text-gray-700 text-left" style="font-size: 0.9674rem">
                <th class="px-4 py-2">Tytuł</th>
                <th class="px-4 py-2">Autor</th>
                <th class="px-4 py-2">Kurs</th>
              </tr>
              </thead>
              <tbody class="text-sm font-normal text-gray-700">
              {% for notice in notices %}
                <tr class="hover:bg-gray-100 border-b border-gray-200 py-10">
                  <td class="px-4 py-4">{{ notice.title }}
                    {% if user in notice.not_viewed.all %}
                      <span class="duration-300 rounded-full font-bold px-2 py-1 text-xs text-white bg-green-400 hover:bg-green-500">NOWE</span>
                    {% endif %}</td>
                  <td class="px-4 py-4"><a class="text-blue-400 hover:text-blue-500" href="{% url 'users:profile-detail' notice.sender.pk %}">{{ notice.sender.first_name }} {{ notice.sender.last_name }}</a></td>
                  <td class="px-4 py-4"><a class="text-blue-400 hover:text-blue-500" href="{% url 'courses:courses-detail' notice.course.slug %}">{{ notice.course.name }}</a></td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
          <div class="mt-8 mb-2">
            <a href="{% url 'users:notices' %}" class="text-sm font-bold mt-2 mb-4 px-4 transition-all duration-200 py-2 px-2 rounded-lg bg-gray-200 text-gray-800 hover:text-gray-900 hover:bg-gray-300">
              Przejdź do ogłoszeń
            </a>
          </div>
        {% endif %}
      </div>
    </div>
    <div class="flex flex-wrap md:px-8 lg:px-16 xl:px-32">
      <div class="overflow-x-auto mt-6 w-1/2 bg-white pb-4 px-4 lg:flex-1 rounded-md w-full mr-4 shadow-md ">
        <h4 class="pt-4 text-lg leading-6 font-medium text-gray-900 mb-2">Nadchodzące wykłady</h4>
        {% if not lectures.all %}
          <p class="text-gray-700 text-sm">Nie znaleziono żadnych nadchodzących wykładów</p>
        {% else %}
          <table class="table-auto border-collapse w-full mt-1">
            <tbody class="text-sm font-normal text-gray-700">
            {% for lecture in lectures %}
              <tr class="hover:bg-gray-100 border-b border-gray-200 py-10">
                <td class="px-4 py-4"><a href="{% url 'courses:lectures-detail' lecture.pk %}" class="text-blue-400 hover:text-blue-500">{{ lecture.title }}</a></td>
                <td class="px-4 py-4"><a class="text-blue-400 hover:text-blue-500" href="{% url 'courses:courses-detail' lecture.course.slug %}">{{ lecture.course.name }}</a></td>
                <td class="px-4 py-4">{{ lecture.date|date:"h:i, d.m.Y" }}</td>
                <td class="px-4 py-4">{% if lecture.location == '1' %}Zdalnie{% else %}Na uczelni{% endif %}</td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        {% endif %}
      </div>
      <div class="overflow-x-auto mt-6 w-1/2 bg-white pb-4 px-4 lg:flex-1 rounded-md w-full mr-4 shadow-md ">
        <h4 class="pt-4 text-lg leading-6 font-medium text-gray-900 mb-2">Nadchodzące laboratoria</h4>
        {% if not laboratories.all %}
          <p class="text-gray-700 text-sm">Nie znaleziono żadnych nadchodzących laboratoriów</p>
        {% else %}
          <table class="table-auto border-collapse w-full mt-1">
            <tbody class="text-sm font-normal text-gray-700">
            {% for lab in laboratories %}
              <tr class="hover:bg-gray-100 border-b border-gray-200 py-10">
                <td class="px-4 py-4"><a href="{% url 'courses:laboratory-detail' lab.pk %}" class="text-blue-400 hover:text-blue-500">{{ lab.title }}</a></td>
                <td class="px-4 py-4"><a class="text-blue-400 hover:text-blue-500" href="{% url 'courses:courses-detail' lab.course.slug %}">{{ lab.course.name }}</a></td>
                <td class="px-4 py-4">{{ lab.date|date:"h:i, d.m.Y" }}</td>
                <td class="px-4 py-4">{% if lab.location == '1' %}Zdalnie{% else %}Na uczelni{% endif %}</td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        {% endif %}
      </div>
    </div>
  </div>
  <script>
    var ctx = document.getElementById('marks').getContext('2d');
    var chart = new Chart(ctx, {
      // The type of chart we want to create
      type: 'bar',

      // The data for our dataset
      data: {
        labels: [{% for course in avg_marks %}'{{ course }}',{% endfor %}],
        datasets: [{
          label: 'Średnie ocen (%)',
          backgroundColor: "#3e95cd",
          data: [{% for course, mark in avg_marks.items %}{{ mark.avg }},{% endfor %} 0]
        }]
      },

      // Configuration options go here
      options: {}
    });
  </script>
{% endblock dashboard_content %}

{% block extraheads %}
  {{ block.super }}
  <style>
    thead tr th:first-child { border-top-left-radius: 10px; border-bottom-left-radius: 10px;}
    thead tr th:last-child { border-top-right-radius: 10px; border-bottom-right-radius: 10px;}
    tbody tr td:first-child { border-top-left-radius: 5px; border-bottom-left-radius: 0px;}
    tbody tr td:last-child { border-top-right-radius: 5px; border-bottom-right-radius: 0px;}
  </style>
{% endblock extraheads %}
